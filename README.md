# ğŸ¤– DrawingBoard

<!-- ciRelease -->

[ci-release-shield]: https://github.com/AI-flow-task/drawing-board/workflows/Release/badge.svg
[ci-release-url]: https://github.com/AI-flow-task/drawing-board/actions/workflows/release.yml

[https://drawing-board.antdigital.dev/](https://drawing-board.antdigital.dev/)

## äº§å“æ¦‚è¿°

ğŸ’¡ é€šè¿‡æ‹–æ‹½æ¥æ„å»ºè‡ªå·±çš„ AI å·¥ä½œæµã€‚

- ç•Œé¢ç¾è§‚ï¼šé‡‡ç”¨äº†ç²¾å¿ƒè®¾è®¡çš„ç”¨æˆ·ç•Œé¢ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åœ°ä½¿ç”¨ç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½ã€‚ç•Œé¢å¸ƒå±€æ¸…æ™°ï¼Œå›¾å½¢å…ƒç´ å’Œé¢œè‰²æ­é…å’Œè°ï¼Œæä¾›ç›´è§‚çš„å¯¼èˆªå’Œæ“ä½œã€‚
- å¤šæ¨¡å‹æ”¯æŒï¼šé™¤äº†æ”¯æŒ LLMï¼ˆLanguage Modelï¼‰å¤–ï¼Œè¿˜å…·å¤‡é›†æˆå’Œæ”¯æŒå…¶ä»–å¤šç§æ¨¡å‹çš„èƒ½åŠ›ã€‚å¼€å‘äººå‘˜å¯ä»¥æŒ‰ç…§ä¸€å¥—è§„èŒƒå°†å…¶ä»–ä»»æ„æ¨¡å‹æœåŠ¡æ¥å…¥ç³»ç»Ÿï¼Œæ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½èŒƒå›´ï¼Œæ»¡è¶³ç”¨æˆ·çš„ä¸åŒéœ€æ±‚ã€‚
- çµæ´»çš„é›†æˆèƒ½åŠ›ï¼šæä¾›äº†ä¸€å¥—æ ‡å‡†çš„æ¥å£å’Œè§„èŒƒï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè½»æ¾åœ°é›†æˆå…¶ä»–ä»»æ„æœåŠ¡ã€‚è¿™æå¤§åœ°å¢å¼ºäº†ç³»ç»Ÿçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½¿å…¶èƒ½å¤Ÿé€‚åº”å„ç§ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œæ¨¡å‹éœ€æ±‚ã€‚
- å¼ºå¤§çš„ SDK æ”¯æŒï¼šæä¾›äº†å…¨é¢çš„è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼ˆSDKï¼‰ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿå°†ç”Ÿæˆçš„å·¥ä½œæµè½»æ¾åœ°é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿä¸­ã€‚ä¸è®ºæ˜¯å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰è¿˜æ˜¯æœåŠ¡ç«¯åº”ç”¨ï¼ŒSDK éƒ½æä¾›äº†ä¸°å¯Œçš„æ¥å£å’ŒåŠŸèƒ½ï¼Œç®€åŒ–äº†æ•´åˆæµç¨‹ï¼ŒåŠ å¿«äº†ç³»ç»Ÿçš„éƒ¨ç½²å’Œåº”ç”¨ã€‚

æ„¿æ™¯ï¼š å°† AI èƒ½åŠ›ä½œä¸ºä¸€ä¸ªæ¨¡å—åµŒå…¥åˆ°ç°æœ‰çš„åŠŸèƒ½ï¼Œä¸ºä¸šåŠ¡å¸¦æ¥æ›´å¼ºçš„ç«äº‰åŠ›ã€‚

## ç«å“

### AI Builder

åŠŸèƒ½å¼ºå¤§ï¼Œç•Œé¢å¯é ï¼Œåä¸“ä¸šçš„ç®—æ³•å¼€å‘åŒå­¦ï¼Œé—¨æ§›å¾ˆé«˜ã€‚ä¸Šé™æ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ä¸‹é™ä¹Ÿå¾ˆä½ã€‚ [AI Builder æ¦‚è¿° - AI Builder](https://learn.microsoft.com/zh-cn/ai-builder/overview)

### Questflow

åŠŸèƒ½å¼ºå¤§æ”¯æŒå„ç§èŠ‚ç‚¹ï¼Œç•Œé¢ä¹Ÿæ¯”è¾ƒç¾è§‚ï¼Œå¼€å‘é—¨æ§›ä¸­ç­‰ï¼Œåšçš„æ˜¯è‡ªåŠ¨åŒ–çš„å·¥ä½œæµï¼Œä¸æ”¯æŒé›†æˆï¼Œå®šä½æ˜¯ä¸€ä¸ªä¸ªäººå·¥å…·ã€‚ [Questflow: Build AI agents for workflow automation with no-code](https://www.questflow.ai/)

### flowiseai

åŠŸèƒ½æ¯”è¾ƒç¾¸å¼±ï¼Œåªæ”¯æŒ LLM ï¼Œæ˜¯ä¸ªæ¯”è¾ƒå¥½çš„ç©å…·ï¼Œä¹Ÿæ˜¯å¸‚é¢ä¸Šæœ€å¤šçš„ä¸€ç§ä»»åŠ¡æµæ¨¡å¼ã€‚ [FlowiseAI - Build LLMs Apps Easily](https://flowiseai.com/?continueFlag=9406bc0089954e011896dda1a8ac4d07)

## å¿«é€Ÿå¼€å§‹

```shell
git clone git@github.com:AI-flow-task/drawing-board.git
pnpm i
pnpm run dev
```

çœ‹åˆ°è¿™æ ·çš„ç•Œé¢å°±æ˜¯å¯åŠ¨æˆåŠŸäº†ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688886273722-908f713a-b17b-471b-bd3a-f75dabe142f5.png#averageHue=%23b8b8b8&clientId=u65d7d55a-2098-4&from=paste&height=757&id=u66b76309&originHeight=1514&originWidth=2660&originalType=binary&ratio=2&rotation=0&showTitle=false&size=523421&status=done&style=none&taskId=u08001f71-8137-4135-be29-5bcaf01f5bf&title=&width=1330)

### ç¯å¢ƒå˜é‡

å¦‚æœè¦å®Œç¾è¿è¡Œï¼Œéœ€è¦é…ç½®ä¸¤ä¸ªç¯å¢ƒå˜é‡:

#### OPENAI_API_KEY

è®¿é—® openai çš„æœåŠ¡éœ€è¦æƒ³ç”¨çš„ token keyï¼ŒOPENAI_API_KEY å¯ä»¥é…ç½®ä¸ºè‡ªå·±çš„ keyã€‚

#### OPENAI_PROXY_URL

ç”±äº openai çš„å°ç¦é—®é¢˜ï¼Œå›½å†…ä½¿ç”¨ä¸€èˆ¬ä¼šæœ‰é—®é¢˜ï¼ŒOPENAI_PROXY_URL å¯ä»¥é…ç½®ä¸ºä¸€ä¸ªä»£ç†åœ°å€ï¼Œopenai çš„è¯·æ±‚ä¼šè¢«è½¬å‘åˆ° OPENAI_PROXY_URLã€‚

```shell
export OPENAI_PROXY_URL=https://my.openai.com
```

#### API_END_PORT_URL

AI ç¯å¢ƒåœ¨æœ¬åœ°æœ‰å¯èƒ½æ­å»ºæˆæœ¬å¤ªé«˜ï¼ŒAPI_END_PORT_URL å¯ä»¥å°†æœ¬åœ°çš„æœåŠ¡æ˜ å°„åˆ°ç›¸åº”çš„æœåŠ¡ç«¯ã€‚

```shell
export API_END_PORT_URL=https://drawing-board.antdigital.dev
```

## ä½¿ç”¨æŒ‡å—

### ç°æœ‰åŠŸèƒ½

- ä»»åŠ¡æµç¼–æ’
- è§’è‰²ç®¡ç†
- ä»»åŠ¡æµè¿è¡Œ

### ä»»åŠ¡æµç¼–æ’

ä»»åŠ¡æµç¼–æ’ç”¨äºè®¾ç½®è‡ªå·±çš„ä»»åŠ¡æµï¼ŒåŸºäºä»»åŠ¡èŠ‚ç‚¹æ¥ç¼–æ’å‡ºè‡ªå·±çš„ AI å·¥ä½œæµï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ä¸€ä¸ªè¿è¥æ´»åŠ¨æ¥ä½œä¸ºä¾‹å­ã€‚

é¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸€ä¸ªä»»åŠ¡æµï¼š

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688827736559-bf302883-58eb-4f7a-a256-fff377f00f2f.png#averageHue=%23f0f0f0&clientId=u12cefbde-3aa4-4&from=paste&height=703&id=u52f0daf2&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=263006&status=done&style=shadow&taskId=uc31bcc5c-cce3-4e87-b63d-8dfb463d0f4&title=&width=1308)

æˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹å†…ç½®çš„èŠ‚ç‚¹:

- ğŸ“ æ–‡æœ¬èŠ‚ç‚¹ - ä½œä¸ºè¾“å…¥æ•°æ®æ¥è·å–è¾“å…¥æ•°æ®
- ğŸ¤– AI èŠ‚ç‚¹ - ä½¿ç”¨å¤§æ¨¡å‹æ¥å¤„ç†æ•°æ®ï¼Œé»˜è®¤æ˜¯ chatgpt
- ğŸ§‘â€ğŸ¨ æ–‡ç”Ÿå›¾èŠ‚ç‚¹ - è°ƒç”¨ SD æ¥ç”Ÿæˆå›¾ç‰‡
- ğŸ”— ç½‘ç»œèŠ‚ç‚¹ - å°†æ•°æ®å‘é€ç»™æŸä¸ªæœåŠ¡å™¨

#### æ–‡æœ¬èŠ‚ç‚¹

æ–‡æœ¬èŠ‚ç‚¹ä¸€èˆ¬ä½œä¸ºé¡¹ç›®å¾—å¼€å§‹ï¼Œç”¨äºè·å–è¾“å…¥æ•°æ®ã€‚ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå¿…å¡«çš„è¾“å…¥ï¼Œåœ¨è¿è¡Œæ—¶ä¼šä½œä¸ºèŠ‚ç‚¹å¾—å‰ç½®æ¡ä»¶ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688828001415-85282626-6da0-41bb-bdd4-874b760a184b.png#averageHue=%23f9f9f9&clientId=u12cefbde-3aa4-4&from=paste&height=170&id=u14cf2de3&originHeight=339&originWidth=1131&originalType=binary&ratio=2&rotation=0&showTitle=false&size=24680&status=done&style=shadow&taskId=u6322b0f5-aa9f-4f0c-bd4e-8a7b895190c&title=&width=565.5)

#### AI èŠ‚ç‚¹

AI èŠ‚ç‚¹æ˜¯è°ƒç”¨å¤§æ¨¡å‹çš„æ•°æ®çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥è§’è‰²è®¾å®š å’Œ æç¤ºè¯ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688827876647-ff2ea090-67d5-4fbb-8d12-52d65568e015.png#averageHue=%23f8f8f8&clientId=u12cefbde-3aa4-4&from=paste&height=768&id=ue5ab07c1&originHeight=1535&originWidth=1106&originalType=binary&ratio=2&rotation=0&showTitle=false&size=127719&status=done&style=shadow&taskId=u7757c947-d22a-4ebf-a9c7-204f04d5457&title=&width=553)

è§’è‰²è®¾å®šå¯ä»¥ç”± è§’è‰²ç®¡ç†ä¸­è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¿«æ·æ–¹å¼æ³¨å…¥ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688828812264-ce0679c5-83d0-471f-8fbf-1ca07606d480.png#averageHue=%23c0bfbf&clientId=u12cefbde-3aa4-4&from=paste&height=751&id=u836a146b&originHeight=1501&originWidth=1737&originalType=binary&ratio=2&rotation=0&showTitle=false&size=295237&status=done&style=shadow&taskId=ueb7c6276-ced1-4c1d-bed7-4af02b60fd6&title=&width=868.5)

è¿™é‡Œæˆ‘ä»¬é€‰æ‹©[æ–‡æ¡ˆä¸“å‘˜]

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688828867176-5be92565-c423-4e28-a432-acaa8ccbe8a2.png#averageHue=%23f4f4f4&clientId=u12cefbde-3aa4-4&from=paste&height=488&id=ud6921305&originHeight=975&originWidth=1083&originalType=binary&ratio=2&rotation=0&showTitle=false&size=139225&status=done&style=shadow&taskId=u50f0ae29-deaa-4bc7-af6b-f767a843f0d&title=&width=541.5) åœ¨è¿è¡Œè¾“å…¥ä¸­æˆ‘ä»¬å¯ä»¥è¾“å…¥ä¸€å†™æç¤ºè¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ è¾“å…¥` {var--name}` æ¥ä»åˆ«çš„èŠ‚ç‚¹è·å–è¾“å…¥ã€‚è¾“å…¥å®Œæˆåå¯ä»¥ç‚¹å‡»è®¾å®šæ¥è®©è¾“å…¥ç”Ÿæ•ˆã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `è¯·æ ¹æ® {input} èŠ‚æ°”ç”Ÿæˆç›¸å…³çš„èŠ‚æ—¥æ–‡æ¡ˆ` ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåœ†åœˆé”šç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ«çš„èŠ‚ç‚¹è¾“å‡ºä¸ä»–ç›¸è”ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688829006385-c94125fa-fdcc-4f96-aee8-ed3d1bf9d2b0.png#averageHue=%23f1f1f1&clientId=u12cefbde-3aa4-4&from=paste&height=565&id=uc75b5606&originHeight=1129&originWidth=1386&originalType=binary&ratio=2&rotation=0&showTitle=false&size=200998&status=done&style=none&taskId=ua598113b-ad4c-498a-8221-8743f6481b2&title=&width=693) æ•ˆæœçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688829057843-caf41646-abb3-4a2b-b5b7-c702a274f7ac.png#averageHue=%23f4f4f4&clientId=u12cefbde-3aa4-4&from=paste&height=560&id=u07258938&originHeight=1119&originWidth=2322&originalType=binary&ratio=2&rotation=0&showTitle=false&size=232114&status=done&style=none&taskId=u83a1ec61-dfb3-483d-b54b-9d51e69eee8&title=&width=1161)

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥è¿è¡ŒèŠ‚ç‚¹æ¥æŸ¥çœ‹æ•ˆæœã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688829116585-554f1d6d-0ca3-4211-95e6-37c990be4357.png#averageHue=%23f1f1f1&clientId=u12cefbde-3aa4-4&from=paste&height=498&id=udb406823&originHeight=996&originWidth=1253&originalType=binary&ratio=2&rotation=0&showTitle=false&size=172848&status=done&style=none&taskId=u229077c3-7c01-49fc-95c1-b4174a37880&title=&width=626.5) è¿è¡Œä¸­çš„èŠ‚ç‚¹ä¼šæœ‰æ‰§è¡Œä¸­çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œç»“æœä¸­é¢„è§ˆç”Ÿæˆçš„å†…å®¹ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†åœ¨è¿è¡Œç»“æœæ—è¾¹å‡ºç°äº†ä¸€ä¸ªé”šç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªèŠ‚æ—¥çš„è¾“å…¥ã€‚å¤šé¡¹è¾“å…¥ä¸å•é¡¹åŸºæœ¬ç›¸åŒï¼Œå¯ä»¥è‡ªå·±å°è¯•è¯•è¯•ã€‚

#### æ–‡ç”Ÿå›¾èŠ‚ç‚¹

æ–‡ç”Ÿå›¾èŠ‚ç‚¹ç”¨äºè°ƒç”¨ stable diffusion æ¥æ ¹æ®æç¤ºè¯ç”Ÿæˆå›¾ç‰‡ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688829344380-9eb9a956-6ee9-43eb-8ab2-d68bfddc1445.png#averageHue=%23f6f6f6&clientId=u1aaddb19-def6-4&from=paste&height=521&id=ua2776f13&originHeight=1042&originWidth=1128&originalType=binary&ratio=2&rotation=0&showTitle=false&size=83498&status=done&style=none&taskId=uacad64f8-3875-495d-ac82-aa47f2f0f3c&title=&width=564) æˆ‘ä»¬å¯ä»¥ç”¨ä¸Šæ¬¡ç”Ÿæˆçš„æ–‡æ¡ˆæ¥è¿›è¡Œå›¾ç‰‡çš„ç»˜åˆ¶ï¼Œç”±äº stable diffusion å¯¹ç›´æ¥è¾“å…¥çš„æ–‡æ¡ˆæ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸­é—´å†åŠ ä¸€ä¸ªèŠ‚ç‚¹æ¥ç”Ÿæˆç›¸åº”çš„æç¤ºè¯ã€‚æ•ˆæœçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688829608201-0e597bdd-1385-4fea-8f88-0e2dd40a5f38.png#averageHue=%23f1f1f1&clientId=u1aaddb19-def6-4&from=paste&height=576&id=u74c87186&originHeight=1151&originWidth=2667&originalType=binary&ratio=2&rotation=0&showTitle=false&size=411284&status=done&style=none&taskId=ub8522750-b4a6-42b0-a651-55e682a3d65&title=&width=1333.5) æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ‰§è¡ŒèŠ‚ç‚¹æ¥æŸ¥çœ‹æ•ˆæœå•¦ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›æç¤ºè¯çš„å¢åŠ å’Œä¿®æ”¹æ¥å›ºå®šç”Ÿæˆçš„å›¾ç‰‡é£æ ¼ã€‚

#### ç½‘ç»œèŠ‚ç‚¹

åŸºäºä»¥ä¸Šçš„æ­¥éª¤æˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªè¿è¥ä»»åŠ¡çš„åŸºæœ¬å·¥ä½œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä¸å¤–ç•Œçš„ç³»ç»Ÿäº¤äº’ï¼Œæˆ‘ä»¬å¯ä»¥é ç½‘ç»œèŠ‚ç‚¹æ¥å°†æ•°æ®å‘é€åˆ°æŒ‡å®šçš„æœåŠ¡ç«¯ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688830635586-a5f12f52-fda6-424f-8103-2782c1f7d231.png#averageHue=%23f5f5f5&clientId=u1aaddb19-def6-4&from=paste&height=358&id=JiRZ4&originHeight=716&originWidth=837&originalType=binary&ratio=2&rotation=0&showTitle=false&size=53646&status=done&style=none&taskId=u89c99643-ac92-4e96-89ea-2fbcfda306f&title=&width=418.5) ç½‘ç»œèŠ‚ç‚¹å¯ä»¥è¾“å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç½‘ç»œåœ°å€ å’Œ è¯·æ±‚çš„å‚æ•°å­—æ®µã€‚é¡¹ç›®é»˜è®¤æä¾›äº†ä¸€ä¸ªæœåŠ¡ç”¨ä½œæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ `node .\test.serve.js` æ¥æ‰“å¼€æœåŠ¡ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688830717909-c3502148-6b29-4951-b83c-e675086a3c74.png#averageHue=%230a0909&clientId=uf23f2515-e8ac-4&from=paste&height=92&id=u75409ed2&originHeight=184&originWidth=644&originalType=binary&ratio=2&rotation=0&showTitle=false&size=15509&status=done&style=none&taskId=u8a28947b-3dd5-413b-adee-79782f0c82c&title=&width=322)

ç„¶åæˆ‘ä»¬å°†æ–‡ç”Ÿå›¾èŠ‚ç‚¹å’Œæ–‡æ¡ˆèŠ‚ç‚¹è¿›è¡Œè¿æ¥ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688830780792-8b03d8f0-2263-4668-be1b-42cb9e1e0efc.png#averageHue=%23f2f2f2&clientId=uf23f2515-e8ac-4&from=paste&height=680&id=u00ce45c2&originHeight=1359&originWidth=1673&originalType=binary&ratio=2&rotation=0&showTitle=false&size=316478&status=done&style=none&taskId=uf5530bfc-9812-4e80-982b-eb9384aa449&title=&width=836.5) ç„¶åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç½‘ç»œèŠ‚ç‚¹çš„è¿”å›ç»“æœã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688830859656-044e6984-53b3-4ea2-9c34-33054f203c6e.png#averageHue=%23f5f5f5&clientId=uf23f2515-e8ac-4&from=paste&height=302&id=ud4fea316&originHeight=604&originWidth=900&originalType=binary&ratio=2&rotation=0&showTitle=false&size=54544&status=done&style=none&taskId=u4cf466d8-b232-4775-b406-f7c48b37fa8&title=&width=450)

åœ¨å‘½ä»¤è¡Œä¸­ä¹Ÿä¼šè¾“å‡ºå‘èµ·çš„è¯·æ±‚å‚æ•°ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688830881983-bc90290d-c81f-4207-82aa-826bf0979c08.png#averageHue=%23040404&clientId=uf23f2515-e8ac-4&from=paste&height=299&id=ub8b38932&originHeight=598&originWidth=2390&originalType=binary&ratio=2&rotation=0&showTitle=false&size=161869&status=done&style=none&taskId=u4b41ab5f-ace6-498e-8ddd-28b8b822fbc&title=&width=1195)

#### æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡

å®Œæˆä»»åŠ¡æµç¼–æ’ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡é¡¶éƒ¨çš„ è¿è¡Œ æ¥è¿›è¡Œæ‰§è¡Œæ•´ä¸ªä»»åŠ¡æµã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688830974915-9c235f25-5f38-4a55-80da-6593b08b39a0.png#averageHue=%23f0f0f0&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u845e05ec&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=391792&status=done&style=none&taskId=ue099b940-924e-4f40-ae9c-c622a8ea1bd&title=&width=1308) ç‚¹å‡»ä¹‹åæ•ˆæœå¦‚ä¸‹ï¼Œä»»åŠ¡æµä¼šä¾æ¬¡æ‰§è¡Œã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688830952806-1cecb967-4f36-403c-afcf-ea1160353b2a.png#averageHue=%23f0f0f0&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=uddf2c8f6&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=398293&status=done&style=none&taskId=u279aa6c3-77e5-4441-8638-04a2f0b4605&title=&width=1308)

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç‚¹å‡»åº•éƒ¨æ¥æŸ¥çœ‹ç»Ÿä¸€çš„çœ‹æ—¥å¿—ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831054908-ec8688fd-109a-4f82-a213-109551c20eb5.png#averageHue=%23f0f0f0&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u15f42738&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=391882&status=done&style=none&taskId=u36b902f1-968e-4b92-bdad-f2d8e380f24&title=&width=1308) è¿™é‡Œä¼šå±•ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€å’Œç»“æœï¼Œå¹¶ä¸”å¯ä»¥éšæ—¶ä¿®æ”¹è¾“å…¥èŠ‚ç‚¹çš„æ•°å€¼ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831105965-830026e0-a9aa-4a09-b74a-87afd447aa18.png#averageHue=%23fbfbfb&clientId=uf23f2515-e8ac-4&from=paste&height=490&id=u7cc157fc&originHeight=979&originWidth=1966&originalType=binary&ratio=2&rotation=0&showTitle=false&size=93538&status=done&style=none&taskId=u0a3a89e7-6f1d-4f6a-8672-b2b637f5d10&title=&width=983)

#### å¯¼å‡º

æˆ‘ä»¬å¯ä»¥åœ¨ä»»åŠ¡æµç¼–æ’çš„å³ä¸Šè§’ç‚¹å‡»å¯¼å‡ºç”Ÿæˆä¸€ä¸ª yaml æ–‡ä»¶ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831980362-d462bc56-63dd-4067-8cd9-39796372ebdf.png#averageHue=%23efe5e4&clientId=uf23f2515-e8ac-4&from=paste&height=161&id=u0eeb1e10&originHeight=322&originWidth=688&originalType=binary&ratio=2&rotation=0&showTitle=false&size=46312&status=done&style=none&taskId=uab6e1c77-5dd1-4398-bde7-7897ecdf8ea&title=&width=344) æˆ‘ä»¬å¯ä»¥ vscode æ¥æŸ¥çœ‹å†…å®¹ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688832028176-b85f294a-8b53-4b33-932c-09b8659242ae.png#averageHue=%23e3d4a6&clientId=uf23f2515-e8ac-4&from=paste&height=140&id=u0ea86b82&originHeight=280&originWidth=1289&originalType=binary&ratio=2&rotation=0&showTitle=false&size=54458&status=done&style=none&taskId=u5fa8f674-67f1-408e-be57-2aaa2634f8b&title=&width=644.5)

#### å¯¼å…¥

æˆ‘ä»¬å¯ä»¥åœ¨å³ä¸Šè§’ç‚¹å‡»æ“ä½œï¼Œé€‰æ‹©å¯¼å…¥ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688832069282-ed731463-3082-476d-9486-084f7905e222.png#averageHue=%23fb4c34&clientId=uf23f2515-e8ac-4&from=paste&height=142&id=u0536efb7&originHeight=283&originWidth=602&originalType=binary&ratio=2&rotation=0&showTitle=false&size=32836&status=done&style=none&taskId=uf297df77-bcd0-495b-ba16-d9e52151fed&title=&width=301)

è¿™æ—¶å€™ä¼šå¼¹å‡ºä¸€ä¸ªå¼¹æ¡†ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è¾“å…¥ç›¸åº”çš„ yaml é…ç½®

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688832114574-be649f33-7658-4b5a-8b5f-659ea44d870c.png#averageHue=%23cecece&clientId=uf23f2515-e8ac-4&from=paste&height=467&id=u1ad24d03&originHeight=934&originWidth=1826&originalType=binary&ratio=2&rotation=0&showTitle=false&size=121118&status=done&style=none&taskId=u06505895-f9bf-46bc-b8b8-2bf19158175&title=&width=913) æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©æ–‡ä»¶æ¥å¯¼å…¥

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688832147455-a908e71a-11ca-4007-9891-f15bd9f036d8.png#averageHue=%23b5b5b5&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u8cb8179d&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=270393&status=done&style=none&taskId=udfc725b1-2538-4e30-8258-e183aaa01e8&title=&width=1308) é€‰ä¸­æ–‡ä»¶ä¼šå±•ç¤ºä¸€ä¸ªé¢„è§ˆã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688832183546-ec76b2e3-6737-4123-a648-b377433cad2f.png#averageHue=%23bcbcbc&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u2ce76293&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=306650&status=done&style=none&taskId=u087aabde-24a7-47bf-8973-db69823fb44&title=&width=1308)

å¯¼å…¥æˆåŠŸä¹‹åä¼šä¿®æ”¹å½“å‰æ‰“å¼€çš„ä»»åŠ¡æµã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688832217831-1ccf9b94-9ada-4263-a62f-828d30a3cae9.png#averageHue=%23f2f2f2&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=uca1fc475&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=411742&status=done&style=none&taskId=u2642abb6-e100-4f2e-a9cc-729a1e557e0&title=&width=1308)

### è§’è‰²ç®¡ç†

è§’è‰²ç®¡ç†å‹‡äºç®¡ç† AI èŠ‚ç‚¹çš„è§’è‰²è®¾å®šï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿè®¾å®šä¸€äº›å¸¸è§çš„è§’è‰²ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831574751-ea6f16f0-89d0-43c4-b356-723ae9a2fd0d.png#averageHue=%23f3f3f3&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u705b399c&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=355905&status=done&style=none&taskId=ud4ab90d6-e507-4abe-9d17-58853f342cb&title=&width=1308) æˆ‘ä»¬å¯ä»¥ç‚¹å‡»ä¸€ä¸ªè§’è‰²æ¥æŸ¥çœ‹è®¾å®šï¼š

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831612591-8bc9cc2d-d867-4e16-8515-d1da7f4b6ec2.png#averageHue=%23969696&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=ud1f746c9&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=447189&status=done&style=none&taskId=u136cb293-86d5-4c64-8a03-d32bbb80c8b&title=&width=1308)

æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æŸ¥çœ‹æ›´å¤šçš„ä¸­çœ‹åˆ°æ‰€æœ‰çš„è§’è‰²ï¼Œå¹¶ä¸”è¿›è¡Œçš„ç®¡ç†ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831654215-0627d7ef-1282-4eb6-b551-03310c2cdb7a.png#averageHue=%23f3f3f3&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=udfb72a74&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=363383&status=done&style=none&taskId=u26755221-81f9-4ab1-bd7b-80eb65c6638&title=&width=1308)

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831692831-76a64dbd-b765-4363-a873-cfd61fdf3f8b.png#averageHue=%23efefef&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=ufe5e6016&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=514571&status=done&style=none&taskId=u7a8e0379-6b5f-4b3e-92ff-ae3993b4b2a&title=&width=1308)

æˆ‘ä»¬ä¹Ÿå¯ä»¥æ–°å»ºè§’è‰²æ¥è¿›è¡Œè®¾å®šï¼š

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831717810-5af53eab-b2d2-471b-abf6-7c763fb63bc4.png#averageHue=%23f6f6f6&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u4f3a5ff3&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=191818&status=done&style=none&taskId=u40d36590-ee9c-4e85-9a03-38ec5cbc968&title=&width=1308) è¾“å…¥å†…å®¹åæ–°å»ºå³å¯

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831772008-504c7f24-19cb-40a0-8a5d-c59ca1ace99c.png#averageHue=%23f1f1f1&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u35804d4e&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=353279&status=done&style=none&taskId=u09d274df-4187-4061-959f-5c6e93f3314&title=&width=1308)

### è¿è¡Œä»»åŠ¡æµ

å½“æˆ‘ä»¬æ–°å»ºå®Œæˆä»»åŠ¡æµä¹‹åå°±ä¸éœ€è¦è¿›è¡Œä¿®æ”¹äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œä»»åŠ¡æµä¸­è¿›è¡Œä½¿ç”¨ã€‚ä»¥æˆ‘ä»¬åˆšæ‰çš„ ã€æ–°çš„ä»»åŠ¡æµã€‘ä¸ºä¾‹ã€‚ä»»åŠ¡æµä¼šç”Ÿæˆä¸€ä¸ªè¡¨å•ï¼Œè¾“å…¥å®Œæˆç‚¹å‡»ä¸‹ä¸€æ­¥å¯ä»¥æ‰§è¡Œæ¨¡å‹ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831876546-8c350579-1950-4812-b221-25a6b47599e4.png#averageHue=%23bb9c77&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=u6f3ab0f6&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=840628&status=done&style=none&taskId=uc9669e89-b082-4102-9fb2-1ecf5af9d7a&title=&width=1308) æ‰§è¡Œä¸­æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è¾“å…¥å‚æ•°å’Œè¾“å‡ºç»“æœã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688831927752-00efbeb7-fd7f-4734-b713-9cb217b2df3d.png#averageHue=%23c9bda9&clientId=uf23f2515-e8ac-4&from=paste&height=703&id=uab1ea5b8&originHeight=1406&originWidth=2616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1174712&status=done&style=none&taskId=u1f5bfdc5-541f-4b2b-aea9-93fe4c11515&title=&width=1308)

## å¼€å‘èŠ‚ç‚¹

èŠ‚ç‚¹æ˜¯ AI-Flow çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨äº†ä¸€ä¸ªèƒ½åŠ›ï¼Œå®˜æ–¹å†…ç½®äº†ä¸€äº›èŠ‚ç‚¹ï¼Œå¦‚æœä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”å°†å…¶åŠ å…¥åˆ°ç”»å¸ƒä¸­ã€‚

### åŸºæœ¬æ•°æ®ç»“æ„

ä»¥æœ€ç®€å•çš„æ–‡æœ¬èŠ‚ç‚¹ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æˆ‘ä»¬å®ç°äº† `SymbolMasterDefinition`ç±»å‹ã€‚å®ƒæœ‰ä¸€ä¸ªæ³›å‹å‚æ•° ï¼Œç”¨äºè¡¨ç¤ºèŠ‚ç‚¹æ•°æ®çš„ç±»å‹ã€‚æ¥å£åŒ…å«äº† defaultContent å±æ€§ï¼Œç”¨äºå­˜å‚¨èŠ‚ç‚¹çš„é»˜è®¤æ•°æ®ï¼ŒdefaultContent çš„å€¼ä¼šé»˜è®¤æ³¨å…¥åˆ° content ä¸­ï¼Œä¹‹åç¼–è¾‘çš„æ•°æ®ä¼šä¿®æ”¹ content å¯¹è±¡ã€‚

```typescript
export const StringSymbol: SymbolMasterDefinition<StringNodeContent> = {
  id: 'string',
  title: 'æ–‡æœ¬',
  description: 'çº¯æ–‡æœ¬è¾“å…¥èŠ‚ç‚¹',
  // èŠ‚ç‚¹åˆ—è¡¨ä¸­å±•ç¤ºçš„å¤´åƒ
  avatar: 'ğŸ“',
  // é»˜è®¤æ•°æ®
  defaultContent: { text: '' },
  // å®šä¹‰å†…å®¹çš„è¾“å…¥é€»è¾‘
  schema: {
    text: {
      type: 'input',
      title: 'æ–‡æœ¬',
      valueContainer: false,
      component: 'InputArea',
      handles: {
        target: true,
      },
    },
  },
  // æ‹–åŠ¨æ—¶çš„é¢„è§ˆç»„ä»¶
  preview: Preview,
  // æœ€ç»ˆçš„èŠ‚ç‚¹ç»„ä»¶
  render: Render,
  // å¦‚ä½•æ‰§è¡Œè¿™ä¸ªèŠ‚ç‚¹
  run: async (nodeï¼Œaction) => {
    return {
      type: 'text',
      output: node.text,
    };
  },
  // æ‰§è¡Œç»“æœå¦‚ä½•å±•ç¤º
  outputRender: (output) => {
    return output;
  },
};
```

### run å‡½æ•°

run æ˜¯èŠ‚ç‚¹çš„æ ¸å¿ƒé…ç½®ï¼Œä¹Ÿæ˜¯è´Ÿè´£å®ç°å…·ä½“èƒ½åŠ›çš„åœ°æ–¹ã€‚run éœ€è¦æ¥æ”¶ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°ï¼Œå¹¶åœ¨ç»„ä»¶è°ƒç”¨æ—¶æ³¨å…¥ä¸‰ä¸ªå‚æ•°ï¼šcontentã€vars å’Œ actionã€‚ä»¥ä¸‹æ˜¯ run å‡½æ•°çš„ç±»å‹å®šä¹‰ï¼š

```typescript
type ActionType<Content> = {
  // å½“å‰ä»»åŠ¡æµå®ä¾‹
  flow: FlowStore;
  // æ›´æ–°å½“å‰ èŠ‚ç‚¹ çš„ loading çš„çŠ¶æ€
  updateLoading: (loading: boolean) => void;
  // å½“å‰èŠ‚ç‚¹å®ä¾‹
  node: IFlowBasicNode<Content>;
  // åœæ­¢çš„ AbortController å®ä¾‹
  abortController?: AbortController;
  // æ›´æ–°å½“å‰èŠ‚ç‚¹çš„å‚æ•°
  updateParams: (params: Record<string, any>) => void;
  // æ›´æ–°å½“å‰èŠ‚ç‚¹çš„è¾“å‡º
  updateOutput: (output: string) => void;
};

run: (content: Content, vars: Record<string, any>, options: ActionType<Content>) =>
  Promise<{
    type: 'img' | 'text';
    output: string;
  }>;
```

åœ¨ run å‡½æ•°çš„å®ç°ä¸­ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ content å‚æ•°æ¥è®¿é—®ç”¨æˆ·ç¼–è¾‘è¿‡çš„å½“å‰èŠ‚ç‚¹çš„æ•°æ®ã€‚vars å‚æ•°åˆ™å¯ä»¥ç”¨äºè·å–å­˜å‚¨åœ¨å…¶ä»–èŠ‚ç‚¹ä¸­çš„æ•°æ®ã€‚æ­¤å¤–ï¼Œé€šè¿‡ä½¿ç”¨ options å‚æ•°ï¼Œæ‚¨å¯ä»¥æ–¹ä¾¿åœ°æ‰§è¡Œä¸€äº›å¸¸ç”¨çš„å¿«æ·æ“ä½œæˆ–è¿›è¡Œç›¸å…³å¤„ç†ã€‚åœ¨å¤„ç†æµç¨‹ä¸­ï¼Œè¿ç»­è°ƒç”¨ updateOutput å¯ä»¥è·å–æµä¸­çš„æ•°æ®ï¼Œå¹¶é€šè¿‡è°ƒç”¨ updateParams æ¥æ›´æ–°è¯·æ±‚å‚æ•°ã€‚è¿™ç§è®¾è®¡æœ‰åŠ©äºè°ƒè¯•è¿‡ç¨‹çš„è¿›è¡Œï¼Œå¹¶ä¾¿äºä¿ç•™å¿…è¦çš„æ•°æ®ã€‚

```typescript
run: async (node, vars, action) => {
    const prompts = genChatMessages({
      systemRole: node.systemRole,
      messages: node.input,
    });
    const request: LangChainParams = {
      llm: { model: 'gpt3.5-turbo', temperature: 0.6 },
      prompts,
      vars,
    };
    action.updateParams(request);
    let output = '';

    await fetchLangChain({
      params: request,
      onMessageHandle: (text) => {
        output += text;
        action.updateOutput({output,type:"text"});
      },
      onLoadingChange: (loading) => {
        action.updateLoading(loading);
      },
      // æ”¯æŒä»å…¨å±€ç»“æŸ fetchã€‚
      abortController: action.abortController,
    });

    return {
      type: 'text',
      output,
    };
  },
```

å¦‚æœæ²¡æœ‰æµçš„æ“ä½œï¼Œå®ç°èµ·æ¥ä¼šç®€å•å¥½å¤šã€‚

```typescript
run: async (node, vars, { updateParams }) => {
  let data: Record<string, any> = {};
  Object.keys(JSON.parse(node.data)).forEach((key) => {
    data[key] = lodashGet(vars, key);
  });

  const params = { ...node, output: undefined, params: undefined, data: JSON.stringify(data) };

  updateParams(params);

  const res = (await fetchNetworkServe(params)) as unknown as {
    message: string;
  };

  return {
    type: 'text',
    output: JSON.stringify(res, null, 2),
  };
},
```

è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼ŒPromise éœ€è¦è¿”å› type å’Œ output æ¥å‘Šè¯‰ç»„ä»¶å¦‚ä½•å¤„ç†æ•°æ®å’Œæ•°æ®æ˜¯ä»€ä¹ˆã€‚

### schema èŠ‚ç‚¹è¾“å…¥é…ç½®

schema ç”¨äºé…ç½®èŠ‚ç‚¹çš„è¾“å…¥å±æ€§ï¼Œä¼šæ ¹æ® schema æ¥ç”Ÿæˆæœ‰å“ªäº›è¾“å…¥ï¼Œstring èŠ‚ç‚¹çš„ schema å¦‚ä¸‹ï¼š

```typescript
schema: {
    text: {
      // ç±»å‹è¾“å…¥èŠ‚ç‚¹
      type: 'input',
      // å‚æ•°çš„åç§°
      title: 'æ–‡æœ¬',
      // æ˜¯å¦éœ€è¦è¢« node åŒ…è£¹ï¼Œå¦‚æœä¸º false åˆ™ä¸ä¼šæœ‰èƒŒæ™¯é¢œè‰²
      valueContainer: false,
      // éœ€è¦æ¸²æŸ“çš„ç»„ä»¶ç±»å‹
      component: 'Input',
      // å®šä¹‰èŠ‚ç‚¹æ˜¯å¦åŒ…å«é”šç‚¹
      handles: {
        target: true,
      },
    },
  },
```

è¿™ä»£è¡¨å®ƒåªæœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œå¹¶ä¸”è¾“å…¥ç»„ä»¶æ˜¯ä¸ª input çš„æ¡†ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1689001526988-18dace08-f4aa-485a-ab3a-30dc251401f8.png#averageHue=%23f7f7f7&clientId=ud97daccb-a37f-4&from=paste&height=195&id=u16c137a8&originHeight=390&originWidth=1096&originalType=binary&ratio=2&rotation=0&showTitle=false&size=30053&status=done&style=none&taskId=u410e1356-f510-417b-8f9e-1c6c50d0877&title=&width=548) å½“ç„¶æˆ‘ä»¬ä¹Ÿæ”¯æŒå…¶ä»–çš„ä¸€äº›è¾“å…¥ç»„ä»¶ï¼š

- Input è¾“å…¥æ¡†
- Segmented å¤šé€‰
- InputArea è¾“å…¥åŒºåŸŸ
- SystemRole è§’è‰²è®¾å®š
- TaskPromptsInput æç¤ºè¯è®¾å®š

åœ¨ AI èŠ‚ç‚¹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ç¤ºä¾‹ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1689001646872-63808713-8687-4370-a0d0-e8684c66678f.png#averageHue=%23ededed&clientId=ud97daccb-a37f-4&from=paste&height=493&id=u0b33e492&originHeight=986&originWidth=1076&originalType=binary&ratio=2&rotation=0&showTitle=false&size=260678&status=done&style=none&taskId=ub858a367-6bb6-47ac-a7d6-fd786c505ac&title=&width=538) ç›¸åº”çš„ schema é…ç½®æ˜¯è¿™æ ·çš„, Segmented éœ€è¦å•ç‹¬é…ç½® options æ¥è®¾ç½®é€‰é¡¹ï¼Œåˆ«çš„é…ç½®å¤§å·®ä¸å·®ã€‚

```typescript
schema: {
  model: {
    type: "input",
    valueKey: ["llm", "model"],
    component: "Segmented",
    title: "æ¨¡å‹",
    options: ALL_MODELS.map((model) => ({
      label: model.name,
      value: model.name,
    })),
    valueContainer: false,
  },
  systemRole: {
    type: "input",
    hideContainer: true,
    component: "SystemRole",
    title: "è§’è‰²å®šä¹‰",
    valueContainer: false,
  },
  input: {
    type: "input",
    component: "TaskPromptsInput",
    title: "è¿è¡Œè¾“å…¥",
    // ä¸å±•ç¤º Field ç”±è‡ªå·±ç®¡ç†
    hideContainer: true,
    valueContainer: false,
  },
};
```

### preview é¢„è§ˆç»„ä»¶

Preview ç»„ä»¶ æ‹–æ‹½çš„æ—¶å€™å‡ºç°ï¼Œ ä¼šç»™ç”¨æˆ·æä¾›ä¸€ä¸ªç®€å•çš„é¢„è§ˆç•Œé¢æ¥å‘Šè¯‰ç”¨æˆ·è‡ªå·±çš„åŠ å…¥çš„æ˜¯ä»€ä¹ˆèŠ‚ç‚¹ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688995753145-46482ca6-2f00-49a5-8dda-240c714ea54b.png#averageHue=%23f6f6f6&clientId=u1b196c22-fa57-4&from=paste&height=310&id=u0cbdbc1c&originHeight=619&originWidth=1016&originalType=binary&ratio=2&rotation=0&showTitle=false&size=39403&status=done&style=none&taskId=u81f8f0de-ab97-4180-84d3-ce7838050c8&title=&width=508)

é€šå¸¸æƒ…å†µä¸‹ï¼Œé¢„è§ˆåŠŸèƒ½åªéœ€è¦æä¾›ä¸€ä¸ªåä¸º `React.FC<{id: string, type: string}>` çš„ React ç»„ä»¶ã€‚ç¼–è¾‘å™¨ä¼šè‡ªåŠ¨æ³¨å…¥ id``å’Œ`type`è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­`type `è¡¨ç¤ºèŠ‚ç‚¹çš„ç±»å‹ä¹Ÿå°±æ˜¯æ˜¯èŠ‚ç‚¹çš„é…ç½® idã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨å›¾ç‰‡ä½œä¸ºé¢„è§ˆèŠ‚ç‚¹çš„æœ€ä½³æ–¹å¼ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­ï¼š

```typescript
export const StringSymbol: SymbolMasterDefinition<StringNodeContent> = {
  id: 'string',
  title: 'æ–‡æœ¬',
  description: 'çº¯æ–‡æœ¬è¾“å…¥èŠ‚ç‚¹',
  avatar: 'ğŸ“',
  defaultContent: { text: '' },
  preview: ({ id, type }) => <Image src={`/image/${type}/string.png`} />,
  schema: {
    text: {
      type: 'input',
      title: 'æ–‡æœ¬',
      valueContainer: false,
      component: 'InputArea',
      handles: {
        target: true,
      },
    },
  },
};
```

ä¸è®¾ç½® `preview` çš„æƒ…å†µä¸‹çš„ Preview ä¼šä½¿ç”¨çš„ schema çš„é…ç½®æ¥ç”Ÿæˆä¸€äº›åªè¯»çš„é¢„è§ˆï¼Œæ¯”å¦‚ä¸Šé¢çš„ schema é…ç½®å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹çš„é¢„è§ˆã€‚

![image.png](https://cdn.nlark.com/yuque/0/2023/png/84868/1688996933857-dcbfd805-3ae8-4692-a8c9-057bf2a4e216.png#averageHue=%23f8f8f8&clientId=ud97daccb-a37f-4&from=paste&height=165&id=uf0e875c3&originHeight=478&originWidth=1118&originalType=binary&ratio=2&rotation=0&showTitle=false&size=32631&status=done&style=none&taskId=u84736e43-bb15-4480-b89b-a5086c87582&title=&width=386) å¦‚æœä½ çš„è¾“å…¥æ•°æ®ä¸€èˆ¬ï¼Œå¯ä»¥æ— éœ€å…³å¿ƒé¢„è§ˆç»„ä»¶ï¼Œä¸è®¾ç½®å³å¯ã€‚

### render èŠ‚ç‚¹è¿è¡Œ

render æ–¹æ³•å†³å®šäº†ç»„ä»¶åœ¨ç”»å¸ƒä¸Šçš„å±•ç¤ºæ•ˆæœï¼Œå®ƒæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªæ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®å¯¹è¯¥æ–¹æ³•è¿›è¡Œé…ç½®ï¼Œ AI èŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­çš„å¯ä»¥å‚è€ƒä¸‹å®ç°ã€‚

```typescript
export const AITaskSymbol: SymbolMasterDefinition<AITaskContent> = {
  id: 'aiTask',
  title: 'AIèŠ‚ç‚¹',
  avatar: 'ğŸ¤–',
  description: 'ä½¿ç”¨å¤§æ¨¡å‹å¤„ç†ä»»åŠ¡',
  defaultContent: initAITaskContent,
  schema: {
    model: {
      type: 'input',
      valueKey: ['llm', 'model'],
      component: 'Segmented',
      title: 'æ¨¡å‹',
      options: ALL_MODELS.map((model) => ({
        label: model.name,
        value: model.name,
      })),
      valueContainer: false,
    },
    systemRole: {
      type: 'input',
      hideContainer: true,
      component: 'SystemRole',
      title: 'è§’è‰²å®šä¹‰',
      valueContainer: false,
    },
    input: {
      type: 'input',
      component: 'TaskPromptsInput',
      title: 'è¿è¡Œè¾“å…¥',
      hideContainer: true,
      valueContainer: false,
    },
  },
  onCreateNode: (node, activeData) => {
    if (activeData?.source === 'agent') {
      const agent = activeData as unknown as ChatAgent;
      return createNode(
        node,
        createAITaskContent({
          llm: { model: 'gpt-3.5-turbo' },
          systemRole: agent.content,
        }),
        agent,
      );
    }
    return createNode(node, initAITaskContent, { title: 'AI èŠ‚ç‚¹' });
  },
  run: async (node, vars, action) => {
    const prompts = genChatMessages({
      systemRole: node.systemRole,
      messages: node.input,
    });
    const request: LangChainParams = {
      llm: { model: 'gpt3.5-turbo', temperature: 0.6 },
      prompts,
      vars,
    };
    action.updateParams(request);
    let output = '';
    await fetchLangChain({
      params: request,
      onMessageHandle: (text) => {
        output += text;
        action.updateOutput({
          output,
          type: 'text',
        });
      },
      onLoadingChange: (loading) => {
        action.updateLoading(loading);
      },
      abortController: action.abortController,
    });

    return {
      type: 'text',
      output,
    };
  },
};
```

å¦‚æœä½ éœ€è¦è‡ªå®šä¹‰ï¼Œæˆ‘ä»¬ä¼šæŠŠèŠ‚ç‚¹çš„ id ä¼ é€’ç»™ç»„ä»¶ã€‚

```typescript
export const AITaskSymbol: SymbolMasterDefinition<AITaskContent> = {
  id: 'aiTask',
  title: 'AIèŠ‚ç‚¹',
  avatar: 'ğŸ¤–',
  description: 'ä½¿ç”¨å¤§æ¨¡å‹å¤„ç†ä»»åŠ¡',
  defaultContent: initAITaskContent,
  render: ({ id }) => <div>{id}</div>,
};
```

è¦å®ç°å¤æ‚çš„åŠŸèƒ½ï¼Œå°±éœ€è¦ç†Ÿç»ƒçš„ä½¿ç”¨æ•°æ®æµï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µéœ€è¦ç†è§£ä¸€ä¸‹ flow å’Œ nodeã€‚flow ä»£è¡¨å·¥ä½œæµæœ¬èº«ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢ç®¡ç†èŠ‚ç‚¹ï¼Œè¿çº¿å’Œä¸€äº› flow çš„åŸºæœ¬ä¿¡æ¯ã€‚Node ä»£è¡¨å®ä¾‹åŒ–ä¹‹åçš„èŠ‚ç‚¹ï¼Œä¿®æ”¹æ•°æ®ä¹‹åéœ€è¦åŒæ­¥æ›´æ–° node èŠ‚ç‚¹ä¸Šçš„æ•°æ®ã€‚

```typescript
export interface FlowState {
  activeId: string | null;
  keywords: string;
  showNodeManager: boolean;
  nodeManagerKeywords: string;
  displayMode: FlowDisplayMode;
  flows: WorkflowMap;
  loading?: boolean;
  terminalHeight: number;
  showTerminal: boolean;
  editor: FlowEditorInstance;
}

export interface FlowCRUDSlice {
  dispatchFlow: (payload: FlowsDispatch, debug?: { type: string } & any) => void;
  createFlow: () => void;
  createFlowBaseOnAgent: (agent: ChatAgent) => void;
  removeFlow: (id: string) => void;
  importFlow: (id: string, flow: string) => void;
  openImportFlowModal: (id: string) => void;
  closeImportFlowModal: (id: string) => void;
  /**
   * å¯¼å‡ºæ‰€æœ‰èŠ‚ç‚¹
   * @returns
   */
  exportWorkflow: () => void;
}

export interface FlowRunnerSlice {
  runFlowNode: (nodeId: string) => Promise<void>;
  abortFlowNode: (id: string) => void;
  /**
   * è¿è¡Œæ‰€æœ‰èŠ‚ç‚¹
   * @returns
   */
  runFlow: () => void;
  /**
   * å–æ¶ˆæ‰€æœ‰èŠ‚ç‚¹çš„è¿è¡Œ
   * @returns
   */
  cancelFlowNode: () => void;
}

export type FlowStore = FlowCRUDSlice & FlowRunnerSlice & FlowState;
```

å…¶ä¸ŠåŒ…å«ç€æ‰€æœ‰çš„ä»»åŠ¡æµçš„ç®¡ç†æ–¹æ³•å’Œä¸€äº›å…ƒæ•°æ®å¯ä»¥æŒ‰éœ€å–ç”¨ã€‚åœ¨ç»„ä»¶ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡ `useFlowStore` å’Œ `flowSelectors` æ¥è·å–åˆ°å½“å‰çš„ä»»åŠ¡æµï¼Œæ›´å¤šçš„é«˜çº§åŠŸèƒ½éœ€è¦æ¥æ¢ç´¢ä¸€ä¸‹ï¼Œæˆ‘ä»¬æä¾›äº†è¯¦ç»†å‡†ç¡®çš„ç±»å‹å®šä¹‰ã€‚

```typescript
const RunButton = () => {
  const [flow] = useFlowStore((s) => [flowSelectors.currentFlowMeta(s)], shallow);
  return <div onclick={() => flow.runFlow()}>run</div>;
};
```

node çš„å®šä¹‰ç›¸å¯¹å¤æ‚ä¸€äº›ï¼Œæ¯•ç«Ÿæ‰€æœ‰çš„è„æ´»éƒ½åœ¨ Node ä¸­å®Œæˆçš„ã€‚

```typescript
export type Node<T = any, U extends string | undefined = string | undefined> = {
  id: string;
  position: XYPosition;
  data: T;
  type?: U;
  style?: CSSProperties;
  className?: string;
  sourcePosition?: Position;
  targetPosition?: Position;
  hidden?: boolean;
  selected?: boolean;
  dragging?: boolean;
  draggable?: boolean;
  selectable?: boolean;
  connectable?: boolean;
  deletable?: boolean;
  dragHandle?: string;
  width?: number | null;
  height?: number | null;
  parentNode?: string;
  zIndex?: number;
  extent?: 'parent' | CoordinateExtent;
  expandParent?: boolean;
  positionAbsolute?: XYPosition;
  ariaLabel?: string;
  focusable?: boolean;
  resizing?: boolean;
  [internalsSymbol]?: {
    z?: number;
    handleBounds?: NodeHandleBounds;
    isParent?: boolean;
  };
};
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `getNodeByIdSafe` å’Œ `useFlowStore` æ¥è·å¾—æŸä¸ªå®ä¾‹åŒ–åçš„èŠ‚ç‚¹ï¼Œä¸‹é¢æ˜¯ä¸ªç®€å•çš„ä¾‹å­ã€‚

```typescript
const Render = ({ id }: { id: string }) => {
  const [type] = useFlowStore((s) => {
    const node = flowSelectors.getNodeByIdSafe<Record<string, any>>(id)(s);
    return [node];
  }, shallow);

  // èŠ‚ç‚¹çš„é…ç½®
  const nodeConfig = symbolNodeList.find((item) => item.id === type);

  if (nodeConfig.id === 'string') return <Input />;
};
```

å¤æ‚çš„å®ç°å¯ä»¥çœ‹å®˜æ–¹çš„å®ä¾‹ã€‚

## ç»´æŠ¤å’Œæ”¯æŒ

è¿™ä¸ªé¡¹ç›®åŸºäºå¼€æºç¤¾åŒºçš„ Github å¹³å°ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ç§¯æå‚ä¸å…¶ä¸­ï¼Œä¸å…¶ä»–å¼€å‘è€…è¿›è¡Œäº¤æµå¹¶ä¸ºé¡¹ç›®çš„è¿›æ­¥è´¡çŒ®è‡ªå·±çš„åŠ›é‡ã€‚åœ¨ Github ä¸Šï¼Œæ‚¨å¯ä»¥åˆ©ç”¨é¡¹ç›®çš„ issue åŠŸèƒ½æ¥æå‡ºé—®é¢˜ã€æŠ¥å‘Š bug æˆ–æå‡ºæ”¹è¿›å»ºè®®ã€‚è¿™å¯ä»¥å¸®åŠ©é¡¹ç›®çš„ç»´æŠ¤è€…å’Œå…¶ä»–å¼€å‘è€…æ›´å¥½åœ°äº†è§£å’Œè§£å†³å­˜åœ¨çš„é—®é¢˜ã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡æäº¤ PRï¼ˆPull Requestï¼‰æ¥å¸®åŠ©å¼€æºé¡¹ç›®å˜å¾—æ›´å¥½ã€‚PR æ˜¯ä¸€ç§æè®®æ€§å˜æ›´ï¼Œæ‚¨å¯ä»¥æå‡ºè‡ªå·±çš„ä»£ç ä¿®æ”¹æˆ–åŠŸèƒ½å¢åŠ ï¼Œå¹¶ä¸é¡¹ç›®çš„ç»´æŠ¤è€…ä¸€èµ·è®¨è®ºå’Œæ”¹è¿›ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨ä¸ä»…å¯ä»¥ä¸ºé¡¹ç›®åšå‡ºè´¡çŒ®ï¼Œè¿˜èƒ½ä¸å…¶ä»–å¼€å‘è€…è¿›è¡Œäº¤æµå’Œåä½œï¼Œå…±åŒæ¨åŠ¨é¡¹ç›®çš„å‘å±•ã€‚å‚ä¸å¼€æºé¡¹ç›®æœ‰åŠ©äºæé«˜æ‚¨çš„æŠ€æœ¯èƒ½åŠ›ï¼Œæ‹“å®½è§†é‡ï¼Œå¹¶ä¸å…¶ä»–å¼€å‘è€…å…±åŒå»ºè®¾ä¸€ä¸ªæ›´å¥½çš„è½¯ä»¶ç”Ÿæ€ç³»ç»Ÿã€‚æˆ‘é¼“åŠ±æ‚¨ç§¯æå‚ä¸ç¤¾åŒºè®¨è®ºå’Œè´¡çŒ®ï¼Œäº«å—å¼€æºæ–‡åŒ–çš„ä¹è¶£ã€‚

## æˆæƒå’Œè®¸å¯

```shell
The MIT License (MIT)
Copyright Â© 2023 <copyright holders>

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the â€œSoftwareâ€), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED â€œAS ISâ€, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
```

å¯ä»¥è¿›è¡Œä»»ä½•æ„ä¹‰ä¸Šçš„ å¤åˆ¶ å’Œ ä¿®æ”¹ï¼Œæ¬¢è¿åŸºäºäºŒæ¬¡å¼€å‘æˆ–æä¾› PRã€‚
